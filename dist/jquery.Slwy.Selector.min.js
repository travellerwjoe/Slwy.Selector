/**
 * @preserve jquery.Slwy.Calendar.js
 * @author Joe.Wu
 * @version v0.9.0 - alpha
 */
!function(t,e){"function"==typeof define&&define.amd?require(["jQuery"],e):"undefined"!=typeof module&&"object"==typeof module.exports?module.exports=e(require("jQuery")):t.SlwySelector=e(t.jQuery)}(this,function(t){function e(t){var e=t.prototype,s=[];for(var o in e){"function"==typeof e[o]&&("constructor"!==o&&s.push(o))}return s}function s(t,s){function o(){var e=Array.prototype.unshift,o=s.prototype.constructor.length,i=t.prototype.constructor;o>0&&(e.call(arguments,t.prototype.constructor),i=s.prototype.constructor),i.apply(this,arguments)}function i(){this.constructor=o}var n=e(s),r=e(t);s.displayName=t.displayName,o.prototype=new i;for(var l=0;l<r.length;l++){var a=r[l];o.prototype[a]=t.prototype[a]}for(var l=0;l<n.length;l++){var p=n[l];o.prototype[p]=function(t){var e=function(){},i=s.prototype[t];return t in o.prototype&&(e=o.prototype[t]),function(){return Array.prototype.unshift.call(arguments,e),i.apply(this,arguments)}}(p)}return o}function o(e,s){var o={title:"支持中文搜索",titleBar:!1,data:[],showField:"",showRight:!1,showRightFiled:"",search:!1,searchPlaceholder:"搜索"};this.options=t.extend(!0,o,e),this.$selector=t(l.selector),this.$srcElement=s,this.data=this.options.data,this.dropdown=new i(this),this.init()}function i(e){this.selector=e,this.$dropdown=t(l.dropdown),this.$optionsList=t(l.optionsList),this.hoverIndex=-1,this.activeIndex=-1,this.init()}function n(e){this.$search=t(l.search),e.apply(this,Array.prototype.slice.call(arguments,1))}function r(e){this.$opener=t(l.opener),this.optionsData=[],e.apply(this,Array.prototype.slice.call(arguments,1))}var l={selector:'<div class="slwy-selector"></div>',dropdown:'<div class="slwy-selector-dropdown"></div>',title:'<div class="slwy-selector-title"></div>',optionsList:'<ul class="slwy-selector-options-list"></ul>',search:'<div class="slwy-selector-search"><input type="search" class="slwy-selector-search-input" autocomplete="off"></div>',opener:'<div class="slwy-selector slwy-selector-opener"></div>'},a=".slwy.selector",p={keyupEvent:"keyup"+a,keydownEvent:"keydown"+a,inputEvent:"input"+a,mouseoverEvent:"mouseover"+a,focusEvent:"focus"+a,blurEvent:"blur"+a,clickEvent:"click"+a,hoverEvent:"hover"+a,selectedEvent:"selected"+a},h={hoverClassName:"slwy-selector-hover",activeClassName:"slwy-selector-active",disabledClassName:"slwy-selector-option-disabled"},c=["112-123",27,9,20,"16-19","91-93",13,"33-40",45,46,144,145];o.prototype.init=function(t){this.$selector.appendTo("body"),this.bind(),this.render(),this.setPosition()},o.prototype.bind=function(){var e=this;t(document).on(p.keydownEvent,function(t){if(!e.$selector.is(":hidden")){var s,o,i=t.keyCode||t.which,n=e.dropdown.hoverIndex,r=h.hoverClassName,l=e.dropdown.$optionsList.find("."+r),a=e.dropdown.$optionsList.outerHeight(),p=e.dropdown.$optionsList.find("li").outerHeight(),c=e.dropdown.$optionsList.scrollTop(),d=c,u=d+a;if(38===i){for(n=n>0?n-1:0;l.prev().hasClass(h.disabledClassName);)n--,l=l.removeClass(r).prev();o=n*p,s=o>d?c:30*n}else if(40===i){for(n=n<e.data.length-1?n+1:e.data.length-1;l.next().hasClass(h.disabledClassName);)n++,l=l.removeClass(r).next();o=n*p,s=o>=u?30*(n-9):c}else 13===i&&(e.$srcElement.trigger({type:"selected",text:l.data("text"),value:l.data("data")}),l.addClass(h.activeClassName).siblings().removeClass(h.activeClassName));e.dropdown.$optionsList.scrollTop(s),e.dropdown.hoverIndex=n,e.dropdown.$optionsList.find("li").removeClass(r).eq(n).addClass(r)}}),this.$srcElement.on(p.clickEvent,function(t){e.show()}).on(p.selectedEvent,function(s){t(this).is("input")?t(this).val(s.text):t(this).is("select")&&(t(this).val(s.value.value),e.$opener.text(s.text)),e.hide()}),t(document).on(p.clickEvent,function(s){t(s.target).is(e.$opener||e.$srcElement)||e.$selector.find(t(s.target)).length||e.hide()})},o.prototype.render=function(){if(this.options.titleBar){var e=t(l.title).text(this.options.title);this.$selector.prepend(e)}this.$selector.append(this.dropdown.$dropdown)},o.prototype.show=function(){this.$selector.show(),this.$opener&&this.$opener.addClass("slwy-selector-opener-expanded")},o.prototype.hide=function(){this.$selector.hide(),this.$opener&&this.$opener.removeClass("slwy-selector-opener-expanded")},o.prototype.setPosition=function(){var t=this.$opener||this.$srcElement,e=t.offset(),s=t.outerHeight(),o=t.outerWidth();this.$selector.css({top:e.top+s-2,left:e.left,width:o})},i.prototype.init=function(){var t=this.selector.data.length?this.selector.data:this.selector.getSelectOptionData();this.bind(),this.render(t)},i.prototype.bind=function(){var e=this;this.$optionsList.on(p.hoverEvent,"li",function(s){if(!t(this).hasClass(h.disabledClassName)){var o=h.hoverClassName;t(this).addClass(o).siblings().removeClass(o),e.hoverIndex=t(this).index()}}).on(p.clickEvent,"li",function(s){if(!t(this).hasClass(h.disabledClassName)){var o=t(this).index(),i=e.selector.data.length?e.selector.data[o]:e.selector.optionsData[o],n="object"==typeof i?e.selector.data.length?i[e.selector.options.showField]:i.text:i,r=h.activeClassName;e.selector.$srcElement.trigger({type:"selected",value:i,text:n}),t(this).addClass(r).siblings().removeClass(r)}})},i.prototype.render=function(t){this.$optionsList.html("");var e="",s=t.length;if(s)for(var o=0;o<s;o++){var i="slwy-selector-option ",n=t[o];(n.disabled||n.Disabled)&&(i+=h.disabledClassName),e+='<li class="'+i+'">',this.selector.data.length?"object"==typeof n?this.selector.options.showRight?(e+='<span class="slwy-selector-option-left">'+n[this.selector.options.showField]+"</span>",e+='<span class="slwy-selector-option-right">'+n[this.selector.options.showRightFiled]+"</span>"):e+=n[this.selector.options.showField]:e+=n:this.selector.optionsData.length&&(n.rightText&&this.selector.options.showRight?(e+='<span class="slwy-selector-option-left">'+n.text+"</span>",e+='<span class="slwy-selector-option-right">'+n.rightText+"</span>"):e+=n.text),e+="</li>"}else e+='<li class="'+h.disabledClassName+'">抱歉，没有找到结果！</li>';this.$optionsList.html(e).appendTo(this.$dropdown)},n.prototype.init=function(t){t.call(this)},n.prototype.render=function(t){t.call(this),this.dropdown.$dropdown.prepend(this.$search),this.$search.find("input").attr("placeholder",this.options.searchPlaceholder)},n.prototype.bind=function(e){e.call(this);var s=this;this.$search.find("input").on(p.keyupEvent+" "+p.inputEvent,function(e){for(var o=e.keyCode||e.which,i=0;i<c.length;i++){var n,r=c[i].toString();if(r.indexOf("-")>=0){if(n=r.split("-"),o>=n[0]||o<=n[1])return}else if(o==r)return}console.time("search"),s.filter(t(this).val()),console.timeEnd("search")})},n.prototype.filter=function(t,e){t.call(this),console.time("loop");var s=this.data.length?this.options.showField:"text",o=this.options.showRight?this.data.length?this.options.showRightFiled:"rightText":null,i=this.data.length?this.data:this.optionsData,n=[],r=new RegExp("^"+e.toUpperCase()+".*");if(e)for(var l=0;l<i.length;l++){var a=i[l];r.test(a[s].toUpperCase())&&n.push(a),o&&a[o]&&r.test(a[o].toUpperCase())&&n.push(a)}else n=i;console.timeEnd("loop"),console.time("render"),this.dropdown.render(n),console.timeEnd("render")},r.prototype.init=function(t){t.call(this)},r.prototype.bind=function(t){t.call(this);var e=this;this.$opener.on(p.clickEvent,function(t){e.show()})},r.prototype.render=function(t){t.call(this);var e=this.$srcElement.find("option:selected"),s=e.text(),o=this.$srcElement.val();this.$srcElement.after(this.$opener.text(s).data("value",o).show()).hide()},r.prototype.getSelectOptionData=function(){var e=this.$srcElement.find("option"),s=[];return e.each(function(e,o){var i=t(o).text(),n=t(o).data("right"),r=t(o).attr("value"),l=t(o).is(":disabled");s.push({text:i,rightText:n,value:r,disabled:l})}),this.optionsData=s,s},t.fn.SlwySelector=function(e){var i=o;return e.search&&(i=s(i,n)),t(this).is("select")&&(i=s(i,r)),new i(e,t(this)),t(this)}});