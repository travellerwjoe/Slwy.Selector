/**
 * @preserve jquery.Slwy.Calendar.js
 * @author Joe.Wu
 * @version v0.10.2
 */
!function(t,e){"function"==typeof define&&define.amd?require(["jQuery"],e):"undefined"!=typeof module&&"object"==typeof module.exports?module.exports=e(require("jQuery")):t.SlwySelector=e(t.jQuery)}(this,function(t){function e(t){var e=t.prototype,s=[];for(var o in e){"function"==typeof e[o]&&("constructor"!==o&&s.push(o))}return s}function s(t,s){function o(){var e=Array.prototype.unshift,o=s.prototype.constructor.length,i=t.prototype.constructor;o>0&&(e.call(arguments,t.prototype.constructor),i=s.prototype.constructor),i.apply(this,arguments)}function i(){this.constructor=o}var n=e(s),r=e(t);s.displayName=t.displayName,o.prototype=new i;for(var l=0;l<r.length;l++){var a=r[l];o.prototype[a]=t.prototype[a]}for(var l=0;l<n.length;l++){var p=n[l];o.prototype[p]=function(t){var e=function(){},i=s.prototype[t];return t in o.prototype&&(e=o.prototype[t]),function(){return Array.prototype.unshift.call(arguments,e),i.apply(this,arguments)}}(p)}return o}function o(e,s){var o={title:"支持中文搜索",titleBar:!1,data:[],showField:"",showRight:!1,showRightFiled:"",search:!1,searchPlaceholder:"搜索"};this.options=t.extend(!0,o,e),this.$selector=t(l.selector),this.$srcElement=s,this.data=this.options.data,this.dropdown=new i(this),this.init()}function i(e){this.selector=e,this.$dropdown=t(l.dropdown),this.$optionsList=t(l.optionsList),this.hoverIndex=-1,this.activeIndex=-1,this.init()}function n(e){this.$search=t(l.search),e.apply(this,Array.prototype.slice.call(arguments,1))}function r(e){this.$opener=t(l.opener),this.optionsData=[],e.apply(this,Array.prototype.slice.call(arguments,1))}var l={selector:'<div class="slwy-selector"></div>',dropdown:'<div class="slwy-selector-dropdown"></div>',title:'<div class="slwy-selector-title"></div>',optionsList:'<ul class="slwy-selector-options-list"></ul>',search:'<div class="slwy-selector-search"><input type="search" class="slwy-selector-search-input" autocomplete="off"></div>',opener:'<div class="slwy-selector slwy-selector-opener" tabindex="0"></div>'},a=".slwy.selector",p={keyupEvent:"keyup"+a,keydownEvent:"keydown"+a,inputEvent:"input"+a,mouseoverEvent:"mouseover"+a,focusEvent:"focus"+a,blurEvent:"blur"+a,clickEvent:"click"+a,hoverEvent:"hover"+a,selectedEvent:"selected"+a},h={hoverClassName:"slwy-selector-hover",activeClassName:"slwy-selector-active",disabledClassName:"slwy-selector-option-disabled",optionClassName:"slwy-selector-option",optgroupClassName:"slwy-selector-optgroup",hasOptgroupClassName:"slwy-selector-has-optgroup"},d=["112-123",27,9,20,"16-19","91-93",13,"33-40",45,46,144,145];o.prototype.init=function(t){this.$selector.appendTo("body"),this.bind(),this.render(),this.setPosition()},o.prototype.bind=function(){var e=this;t(document).on(p.keydownEvent,function(t){if(!e.$selector.is(":hidden")){var s,o,i=t.keyCode||t.which,n=e.dropdown.hoverIndex,r=h.hoverClassName,l=e.dropdown.$optionsList.find("."+r),a=e.dropdown.$optionsList.outerHeight(),p=e.dropdown.$optionsList.find("li").outerHeight(),d=e.dropdown.$optionsList.scrollTop(),c=d,u=c+a;if(38===i){var f=l.prev().length?l.prev():e.dropdown.$optionsList.find("li").last();for(n=n>0?n-1:0;f.hasClass(h.disabledClassName)||f.hasClass(h.optgroupClassName);)n--,l=f=f.prev();n<0&&(l=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).first(),n=l.index()),o=n*p,s=o>c?d:30*n}else if(40===i){var v=e.dropdown.$optionsList.find("li").length,y=l.next().length?l.next():e.dropdown.$optionsList.find("li").first();for(n=n<v-1?n+1:v-1;y.hasClass(h.disabledClassName)||y.hasClass(h.optgroupClassName);)n++,l=y=y.next();n>=v&&(l=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).last(),n=l.index()),o=n*p,s=o>=u?30*(n-9):d}else{if(13!==i)return;e.triggerSelected(l)}e.dropdown.$optionsList.scrollTop(s),e.dropdown.hoverIndex=n,e.dropdown.$optionsList.find("li").removeClass(r).eq(n).addClass(r)}}),this.$srcElement.on(p.clickEvent,function(t){e.show()}).on(p.selectedEvent,function(s){t(this).is("input")?t(this).val(s.text):t(this).is("select")&&(t(this).val(s.value.value),e.$opener.text(s.text)),e.hide()}),t(document).on(p.clickEvent,function(s){t(s.target).is(e.$opener||e.$srcElement)||e.$selector.find(t(s.target)).length||e.hide()})},o.prototype.render=function(){if(this.options.titleBar){var e=t(l.title).text(this.options.title);this.$selector.prepend(e)}this.$selector.append(this.dropdown.$dropdown)},o.prototype.show=function(){this.$selector.show(),this.$opener&&this.$opener.addClass("slwy-selector-opener-expanded").blur(),this.$search&&this.$search.find("input").focus()},o.prototype.hide=function(){this.$selector.hide(),this.$opener&&this.$opener.removeClass("slwy-selector-opener-expanded")},o.prototype.setPosition=function(){var t=this.$opener||this.$srcElement,e=t.offset(),s=t.outerHeight(),o=t.outerWidth();this.$selector.css({top:e.top+s-2,left:e.left,width:o})},o.prototype.triggerSelected=function(t){if(!t.hasClass(h.disabledClassName)){var e,s=t.data("index"),o=t.data("subindex"),i=this.data.length?this.data[s]:this.optionsData[s],n=this.data.length?this.options.showField:"text";i&&("object"==typeof i?(i.optgroup&&i.options&&"number"==typeof o&&(i=i.options[o]),e=i[n]):e=i,this.$srcElement.trigger({type:"selected",value:i,text:e}),t.addClass(h.activeClassName).siblings().removeClass(h.activeClassName))}},i.prototype.init=function(){var t=this.selector.data.length?this.selector.data:this.selector.getSelectOptionData();this.bind(),this.render(t)},i.prototype.bind=function(){var e=this;this.$optionsList.on(p.hoverEvent,"li."+h.optionClassName,function(s){if(!t(this).hasClass(h.disabledClassName)){var o=h.hoverClassName;t(this).addClass(o).siblings().removeClass(o),e.hoverIndex=t(this).index()}}).on(p.clickEvent,"li."+h.optionClassName,function(s){e.selector.triggerSelected(t(this))})},i.prototype.render=function(e){this.$optionsList.html("");var s="",o=this.selector.options.showField,i=this.selector.options.showRightFiled,n=this.selector.options.showRight,r=e.length,l=!1,a=function(t,e,s){var r,l=h.optionClassName,e=t.index||e,s=t.subindex||s;return(t.disabled||t.Disabled)&&(l+=" "+h.disabledClassName),r='<li class="'+l+'" data-index="'+e+'"'+("number"==typeof s?' data-subindex="'+s+'"':"")+">",this.selector.data.length?"object"==typeof t?n?(r+='<span class="'+d+'">'+t[o]+"</span>",r+='<span class="'+c+'">'+t[i]+"</span>"):r+=t[o]:r+=t:this.selector.optionsData.length&&(t.rightText?(r+='<span class="'+d+'">'+t.text+"</span>",r+='<span class="'+c+'">'+t.rightText+"</span>"):r+=t.text),r+="</li>"};if(r)for(var p=0;p<r;p++){var d="slwy-selector-option-left",c="slwy-selector-option-right",u=h.optgroupClassName,f=e[p];if(f.optgroup&&t.isArray(f.options)){s+='<li class="'+u+'">',s+=f.label,s+="</li>";for(var v=0;v<f.options.length;v++)s+=a.call(this,f.options[v],p,v)}else s+=a.call(this,f,p)}else s+='<li class="'+h.disabledClassName+'">抱歉，没有找到结果！</li>';l=/optgroup/.test(s),l&&this.$optionsList.addClass(h.hasOptgroupClassName),this.$optionsList.html(s).appendTo(this.$dropdown)},n.prototype.init=function(t){t.call(this)},n.prototype.render=function(t){t.call(this),this.dropdown.$dropdown.prepend(this.$search),this.$search.find("input").attr("placeholder",this.options.searchPlaceholder)},n.prototype.bind=function(e){e.call(this);var s=this;this.$search.find("input").on(p.keyupEvent+" "+p.inputEvent,function(e){for(var o=e.keyCode||e.which,i=0;i<d.length;i++){var n,r=d[i].toString();if(r.indexOf("-")>=0){if(n=r.split("-"),o>=n[0]||o<=n[1])return}else if(o==r)return}s.filter(t(this).val())})},n.prototype.filter=function(e,s){e.call(this);var o=this.data.length?this.options.showField:"text",i=this.options.showRight?this.data.length?this.options.showRightFiled:"rightText":null,n=this.data.length?this.data:this.optionsData,r=[],l=new RegExp("^"+s.toUpperCase()+".*"),a=function(t,e,s,n){e.index=s,"number"==typeof n&&(e.subindex=n),l.test(e[o].toUpperCase())&&t.push(e),i&&e[i]&&l.test(e[i].toUpperCase())&&t.push(e)};if(s)for(var p=0;p<n.length;p++){var h=n[p];if(h.optgroup&&t.isArray(h.options)){var d={label:h.label,optgroup:!0,options:[]};if(l.test(h.label.toUpperCase()))d.options=h.options;else for(var c=0;c<h.options.length;c++)a.call(this,d.options,h.options[c],p,c);!!d.options.length&&r.push(d)}else a.call(this,r,h,p)}else r=n;this.dropdown.render(r)},r.prototype.init=function(t){t.call(this)},r.prototype.bind=function(t){t.call(this);var e=this;this.$opener.on(p.clickEvent,function(t){e.show()}).on(p.keyupEvent,function(t){13===(t.keyCode||t.which)&&e.show()})},r.prototype.render=function(t){t.call(this);var e=this.$srcElement.find("option:selected"),s=this.options.showField,o=!!this.data.length&&(this.data[0].optgroup?this.data[0].options[0][s]:this.data[0][s])||e.text(),i=this.$srcElement.val();this.$srcElement.after(this.$opener.text(o).data("value",i).show()).hide()},r.prototype.getSelectOptionData=function(){var e=this.$srcElement.find("option"),s=this.$srcElement.find("optgroup").length?this.$srcElement.find("optgroup"):null,o=[],i=function(e,s,o){var i=t(s).text(),n=t(s).data("right"),r=t(s).attr("value"),l=t(s).is(":disabled");e.push({text:i,rightText:n,value:r,disabled:l})};return s?s.each(function(e,s){var n=t(s).find("option"),r=t(s).attr("label"),l={label:r,optgroup:!0,options:[]};n.each(function(t,e){i(l.options,e)}),o.push(l)}):e.each(function(t,e){i(o,e)}),this.optionsData=o,o},t.fn.SlwySelector=function(e){var i=o;return e.search&&(i=s(i,n)),t(this).is("select")&&(i=s(i,r)),new i(e,t(this)),t(this)}});