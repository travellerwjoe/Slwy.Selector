/**
 * @preserve jquery.Slwy.Calendar.js
 * @author Joe.Wu
 * @version v0.10.1
 */
!function(t,e){"function"==typeof define&&define.amd?require(["jQuery"],e):"undefined"!=typeof module&&"object"==typeof module.exports?module.exports=e(require("jQuery")):t.SlwySelector=e(t.jQuery)}(this,function(t){function e(t){var e=t.prototype,o=[];for(var s in e){"function"==typeof e[s]&&("constructor"!==s&&o.push(s))}return o}function o(t,o){function s(){var e=Array.prototype.unshift,s=o.prototype.constructor.length,i=t.prototype.constructor;s>0&&(e.call(arguments,t.prototype.constructor),i=o.prototype.constructor),i.apply(this,arguments)}function i(){this.constructor=s}var n=e(o),r=e(t);o.displayName=t.displayName,s.prototype=new i;for(var l=0;l<r.length;l++){var a=r[l];s.prototype[a]=t.prototype[a]}for(var l=0;l<n.length;l++){var p=n[l];s.prototype[p]=function(t){var e=function(){},i=o.prototype[t];return t in s.prototype&&(e=s.prototype[t]),function(){return Array.prototype.unshift.call(arguments,e),i.apply(this,arguments)}}(p)}return s}function s(e,o){var s={title:"支持中文搜索",titleBar:!1,data:[],showField:"",showRight:!1,showRightFiled:"",search:!1,searchPlaceholder:"搜索"};this.options=t.extend(!0,s,e),this.$selector=t(l.selector),this.$srcElement=o,this.data=this.options.data,this.dropdown=new i(this),this.init()}function i(e){this.selector=e,this.$dropdown=t(l.dropdown),this.$optionsList=t(l.optionsList),this.hoverIndex=-1,this.activeIndex=-1,this.init()}function n(e){this.$search=t(l.search),e.apply(this,Array.prototype.slice.call(arguments,1))}function r(e){this.$opener=t(l.opener),this.optionsData=[],e.apply(this,Array.prototype.slice.call(arguments,1))}var l={selector:'<div class="slwy-selector"></div>',dropdown:'<div class="slwy-selector-dropdown"></div>',title:'<div class="slwy-selector-title"></div>',optionsList:'<ul class="slwy-selector-options-list"></ul>',search:'<div class="slwy-selector-search"><input type="search" class="slwy-selector-search-input" autocomplete="off"></div>',opener:'<div class="slwy-selector slwy-selector-opener" tabindex="0"></div>'},a=".slwy.selector",p={keyupEvent:"keyup"+a,keydownEvent:"keydown"+a,inputEvent:"input"+a,mouseoverEvent:"mouseover"+a,focusEvent:"focus"+a,blurEvent:"blur"+a,clickEvent:"click"+a,hoverEvent:"hover"+a,selectedEvent:"selected"+a},h={hoverClassName:"slwy-selector-hover",activeClassName:"slwy-selector-active",disabledClassName:"slwy-selector-option-disabled",optionClassName:"slwy-selector-option",optgroupClassName:"slwy-selector-optgroup",hasOptgroupClassName:"slwy-selector-has-optgroup"},d=["112-123",27,9,20,"16-19","91-93",13,"33-40",45,46,144,145];s.prototype.init=function(t){this.$selector.appendTo("body"),this.bind(),this.render(),this.setPosition()},s.prototype.bind=function(){var e=this;t(document).on(p.keydownEvent,function(t){if(!e.$selector.is(":hidden")){var o,s,i=t.keyCode||t.which,n=e.dropdown.hoverIndex,r=h.hoverClassName,l=e.dropdown.$optionsList.find("."+r),a=e.dropdown.$optionsList.outerHeight(),p=e.dropdown.$optionsList.find("li").outerHeight(),d=e.dropdown.$optionsList.scrollTop(),c=d,u=c+a;if(38===i){var f=l.prev().length?l.prev():e.dropdown.$optionsList.find("li").last();for(n=n>0?n-1:0;f.hasClass(h.disabledClassName)||f.hasClass(h.optgroupClassName);)n--,l=f=f.prev();n<0&&(l=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).first(),n=l.index()),s=n*p,o=s>c?d:30*n}else if(40===i){var v=e.dropdown.$optionsList.find("li").length,y=l.next().length?l.next():e.dropdown.$optionsList.find("li").first();for(n=n<v-1?n+1:v-1;y.hasClass(h.disabledClassName)||y.hasClass(h.optgroupClassName);)n++,l=y=y.next();n>=v&&(l=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).last(),n=l.index()),s=n*p,o=s>=u?30*(n-9):d}else{if(13!==i)return;e.triggerSelected(l)}e.dropdown.$optionsList.scrollTop(o),e.dropdown.hoverIndex=n,e.dropdown.$optionsList.find("li").removeClass(r).eq(n).addClass(r)}}),this.$srcElement.on(p.clickEvent,function(t){e.show()}).on(p.selectedEvent,function(o){t(this).is("input")?t(this).val(o.text):t(this).is("select")&&(t(this).val(o.value.value),e.$opener.text(o.text)),e.hide()}),t(document).on(p.clickEvent,function(o){t(o.target).is(e.$opener||e.$srcElement)||e.$selector.find(t(o.target)).length||e.hide()})},s.prototype.render=function(){if(this.options.titleBar){var e=t(l.title).text(this.options.title);this.$selector.prepend(e)}this.$selector.append(this.dropdown.$dropdown)},s.prototype.show=function(){this.$selector.show(),this.$opener&&this.$opener.addClass("slwy-selector-opener-expanded").blur(),this.$search&&this.$search.find("input").focus()},s.prototype.hide=function(){this.$selector.hide(),this.$opener&&this.$opener.removeClass("slwy-selector-opener-expanded")},s.prototype.setPosition=function(){var t=this.$opener||this.$srcElement,e=t.offset(),o=t.outerHeight(),s=t.outerWidth();this.$selector.css({top:e.top+o-2,left:e.left,width:s})},s.prototype.triggerSelected=function(t){if(!t.hasClass(h.disabledClassName)){var e,o=t.data("index"),s=t.data("subindex"),i=this.data.length?this.data[o]:this.optionsData[o],n=this.data.length?this.options.showField:"text";i&&("object"==typeof i?(i.optgroup&&i.options&&"number"==typeof s&&(i=i.options[s]),e=i[n]):e=i,this.$srcElement.trigger({type:"selected",value:i,text:e}),t.addClass(h.activeClassName).siblings().removeClass(h.activeClassName))}},i.prototype.init=function(){var t=this.selector.data.length?this.selector.data:this.selector.getSelectOptionData();this.bind(),this.render(t)},i.prototype.bind=function(){var e=this;this.$optionsList.on(p.hoverEvent,"li."+h.optionClassName,function(o){if(!t(this).hasClass(h.disabledClassName)){var s=h.hoverClassName;t(this).addClass(s).siblings().removeClass(s),e.hoverIndex=t(this).index()}}).on(p.clickEvent,"li."+h.optionClassName,function(o){e.selector.triggerSelected(t(this))})},i.prototype.render=function(e){this.$optionsList.html("");var o="",s=this.selector.options.showField,i=this.selector.options.showRightFiled,n=this.selector.options.showRight,r=e.length,l=!1,a=function(t,e,o){var r,l=h.optionClassName,e=t.index||e,o=t.subindex||o;return(t.disabled||t.Disabled)&&(l+=" "+h.disabledClassName),r='<li class="'+l+'" data-index="'+e+'"'+("number"==typeof o?' data-subindex="'+o+'"':"")+">",this.selector.data.length?"object"==typeof t?n?(r+='<span class="'+d+'">'+t[s]+"</span>",r+='<span class="'+c+'">'+t[i]+"</span>"):r+=t[s]:r+=t:this.selector.optionsData.length&&(t.rightText&&this.selector.options.showRight?(r+='<span class="'+d+'">'+t.text+"</span>",r+='<span class="'+c+'">'+t.rightText+"</span>"):r+=t.text),r+="</li>"};if(r)for(var p=0;p<r;p++){var d="slwy-selector-option-left",c="slwy-selector-option-right",u=h.optgroupClassName,f=e[p];if(f.optgroup&&t.isArray(f.options)){o+='<li class="'+u+'">',o+=f.label,o+="</li>";for(var v=0;v<f.options.length;v++)o+=a.call(this,f.options[v],p,v)}else o+=a.call(this,f,p)}else o+='<li class="'+h.disabledClassName+'">抱歉，没有找到结果！</li>';l=/optgroup/.test(o),l&&this.$optionsList.addClass(h.hasOptgroupClassName),this.$optionsList.html(o).appendTo(this.$dropdown)},n.prototype.init=function(t){t.call(this)},n.prototype.render=function(t){t.call(this),this.dropdown.$dropdown.prepend(this.$search),this.$search.find("input").attr("placeholder",this.options.searchPlaceholder)},n.prototype.bind=function(e){e.call(this);var o=this;this.$search.find("input").on(p.keyupEvent+" "+p.inputEvent,function(e){for(var s=e.keyCode||e.which,i=0;i<d.length;i++){var n,r=d[i].toString();if(r.indexOf("-")>=0){if(n=r.split("-"),s>=n[0]||s<=n[1])return}else if(s==r)return}o.filter(t(this).val())})},n.prototype.filter=function(e,o){e.call(this);var s=this.data.length?this.options.showField:"text",i=this.options.showRight?this.data.length?this.options.showRightFiled:"rightText":null,n=this.data.length?this.data:this.optionsData,r=[],l=new RegExp("^"+o.toUpperCase()+".*"),a=function(t,e,o,n){e.index=o,"number"==typeof n&&(e.subindex=n),l.test(e[s].toUpperCase())&&t.push(e),i&&e[i]&&l.test(e[i].toUpperCase())&&t.push(e)};if(o)for(var p=0;p<n.length;p++){var h=n[p];if(h.optgroup&&t.isArray(h.options)){var d={label:h.label,optgroup:!0,options:[]};if(l.test(h.label.toUpperCase()))d.options=h.options;else for(var c=0;c<h.options.length;c++)a.call(this,d.options,h.options[c],p,c);!!d.options.length&&r.push(d)}else a.call(this,r,h,p)}else r=n;console.log(r),this.dropdown.render(r)},r.prototype.init=function(t){t.call(this)},r.prototype.bind=function(t){t.call(this);var e=this;this.$opener.on(p.clickEvent,function(t){e.show()}).on(p.keyupEvent,function(t){13===(t.keyCode||t.which)&&e.show()})},r.prototype.render=function(t){t.call(this);var e=this.$srcElement.find("option:selected"),o=e.text(),s=this.$srcElement.val();this.$srcElement.after(this.$opener.text(o).data("value",s).show()).hide()},r.prototype.getSelectOptionData=function(){var e=this.$srcElement.find("option"),o=this.$srcElement.find("optgroup").length?this.$srcElement.find("optgroup"):null,s=[],i=function(e,o,s){var i=t(o).text(),n=t(o).data("right"),r=t(o).attr("value"),l=t(o).is(":disabled");e.push({text:i,rightText:n,value:r,disabled:l})};return o?o.each(function(e,o){var n=t(o).find("option"),r=t(o).attr("label"),l={label:r,optgroup:!0,options:[]};n.each(function(t,e){i(l.options,e)}),s.push(l)}):e.each(function(t,e){i(s,e)}),this.optionsData=s,s},t.fn.SlwySelector=function(e){var i=s;return e.search&&(i=o(i,n)),t(this).is("select")&&(i=o(i,r)),new i(e,t(this)),t(this)}});