/**
 * @preserve jquery.Slwy.Selector.js
 * @author Joe.Wu
 * @version v0.11.0
 */
!function(t,e){"function"==typeof define&&define.amd?require(["jQuery"],e):"undefined"!=typeof module&&"object"==typeof module.exports?module.exports=e(require("jQuery")):t.SlwySelector=e(t.jQuery)}(this,function(t){function e(t){var e=t.prototype,s=[];for(var o in e){"function"==typeof e[o]&&("constructor"!==o&&s.push(o))}return s}function s(t,s){function o(){var e=Array.prototype.unshift,o=s.prototype.constructor.length,i=t.prototype.constructor;o>0&&(e.call(arguments,t.prototype.constructor),i=s.prototype.constructor),i.apply(this,arguments)}function i(){this.constructor=o}var n=e(s),r=e(t);s.displayName=t.displayName,o.prototype=new i;for(var l=0;l<r.length;l++){var a=r[l];o.prototype[a]=t.prototype[a]}for(var l=0;l<n.length;l++){var p=n[l];o.prototype[p]=function(t){var e=function(){},i=s.prototype[t];return t in o.prototype&&(e=o.prototype[t]),function(){return Array.prototype.unshift.call(arguments,e),i.apply(this,arguments)}}(p)}return o}function o(e,s){var o={title:"支持中文搜索",titleBar:!1,data:[],showField:"",showRight:!1,showRightFiled:"",search:!1,searchPlaceholder:"搜索",searchField:[],viewCount:10,width:null};this.options=t.extend(!0,o,e),this.$selector=t(l.selector),this.$srcElement=s,this.data=this.options.data,this.hasSetPosition=!1,this.isShow=!1}function i(e){this.selector=e,this.$dropdown=t(l.dropdown),this.$optionsList=t(l.optionsList),this.hoverIndex=-1,this.activeIndex=-1,this.init()}function n(e){this.$search=t(l.search),e.apply(this,Array.prototype.slice.call(arguments,1))}function r(e){this.$opener=t(l.opener),this.optionsData=[],e.apply(this,Array.prototype.slice.call(arguments,1))}var l={selector:'<div class="slwy-selector"></div>',dropdown:'<div class="slwy-selector-dropdown"></div>',title:'<div class="slwy-selector-title"></div>',optionsList:'<ul class="slwy-selector-options-list"></ul>',search:'<div class="slwy-selector-search"><input type="search" class="slwy-selector-search-input" autocomplete="off"></div>',opener:'<div class="slwy-selector slwy-selector-opener" tabindex="0"></div>'},a=".slwy.selector",p={keyupEvent:"keyup"+a,keydownEvent:"keydown"+a,inputEvent:"input"+a,mouseoverEvent:"mouseover"+a,focusEvent:"focus"+a,blurEvent:"blur"+a,clickEvent:"click"+a,mouseenterEvent:"mouseenter"+a,selectedEvent:"selected"+a,propertyChangeEvent:"propertychange"+a},h={hoverClassName:"slwy-selector-hover",activeClassName:"slwy-selector-active",disabledClassName:"slwy-selector-option-disabled",optionClassName:"slwy-selector-option",optgroupClassName:"slwy-selector-optgroup",hasOptgroupClassName:"slwy-selector-has-optgroup"},d=["112-123",27,9,20,"16-19","91-93",13,"33-40",45,46,144,145];o.prototype.init=function(t){this.dropdown=new i(this),this.$selector.appendTo("body"),this.bind(),this.render()},o.prototype.bind=function(){var e=this,s=this.options.viewCount-1;t(document).on(p.keydownEvent,function(t){if(!e.$selector.is(":hidden")){var o,i,n=t.keyCode||t.which,r=e.dropdown.hoverIndex,l=h.hoverClassName,a=e.dropdown.$optionsList.find("."+l),p=e.dropdown.$optionsList.outerHeight(),d=e.dropdown.$optionsList.find("li").outerHeight(),c=e.dropdown.$optionsList.scrollTop(),u=c,f=u+p;if(38===n){var v=a.prev().length?a.prev():e.dropdown.$optionsList.find("li").last();for(r=r>0?r-1:0;v.hasClass(h.disabledClassName)||v.hasClass(h.optgroupClassName);)r--,a=v=v.prev();r<0&&(a=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).first(),r=a.index()),i=r*d,o=i>u?c:r*d}else if(40===n){var y=e.dropdown.$optionsList.find("li").length,g=a.next().length?a.next():e.dropdown.$optionsList.find("li").first();for(r=r<y-1?r+1:y-1;g.hasClass(h.disabledClassName)||g.hasClass(h.optgroupClassName);)r++,a=g=g.next();r>=y&&(a=e.dropdown.$optionsList.find("li."+h.optionClassName).not("."+h.disabledClassName).last(),r=a.index()),i=r*d,o=i>=f?(r-s)*d:c}else{if(13!==n)return;e.triggerSelected(a)}e.dropdown.$optionsList.scrollTop(o),e.dropdown.hoverIndex=r,r>=0&&e.dropdown.$optionsList.find("li").removeClass(l).eq(r).addClass(l)}}),this.$srcElement.on(p.clickEvent,function(t){e.show()}).on(p.selectedEvent,function(s){t(this).is("input")?t(this).val(s.text):t(this).is("select")&&(t(this).val(s.value.value),e.$opener.text(s.text)),e.hide()}),t(document).on(p.clickEvent,function(s){t(s.target).is(e.$opener||e.$srcElement)||e.$selector.find(t(s.target)).length||e.hide()})},o.prototype.render=function(){if(this.options.titleBar){var e=t(l.title).text(this.options.title);this.$selector.prepend(e)}this.$selector.append(this.dropdown.$dropdown)},o.prototype.show=function(){this.isShow||(this.$selector.show(),this.hasSetPosition||(this.setPosition(),this.dropdown.setListHeigth()),this.$opener&&this.$opener.addClass("slwy-selector-opener-expanded").blur(),this.$search&&this.$search.find("input").focus(),this.isShow=!0)},o.prototype.hide=function(){this.isShow&&(this.$selector.hide(),this.$opener&&this.$opener.removeClass("slwy-selector-opener-expanded"),this.isShow=!1)},o.prototype.setPosition=function(){var t=this.$opener||this.$srcElement,e=t.offset(),s=t.outerHeight(),o="number"==typeof this.options.width?this.options.width:t.outerWidth();this.$selector.css({top:e.top+s-2,left:e.left,width:o}),this.hasSetPosition=!0},o.prototype.triggerSelected=function(t){if(!t.hasClass(h.disabledClassName)){var e,s=t.data("index"),o=t.data("subindex"),i=this.data.length?this.data[s]:this.optionsData[s],n=this.data.length?this.options.showField:"text";i&&("object"==typeof i?(i.optgroup&&i.options&&"number"==typeof o&&(i=i.options[o]),e=i[n]):e=i,this.$srcElement.trigger({type:"selected",value:i,text:e}),t.addClass(h.activeClassName).siblings().removeClass(h.activeClassName))}},i.prototype.init=function(){var t=this.selector.data.length?this.selector.data:this.selector.optionsData;this.bind(),this.render(t)},i.prototype.bind=function(){var e=this;this.$optionsList.on(p.mouseenterEvent,"li."+h.optionClassName,function(s){if(!t(this).hasClass(h.disabledClassName)){var o=h.hoverClassName;t(this).addClass(o).siblings().removeClass(o),e.hoverIndex=t(this).index()}}).on(p.clickEvent,"li."+h.optionClassName,function(s){e.selector.triggerSelected(t(this))})},i.prototype.render=function(e){this.$optionsList.html("");var s="",o=this.selector.options.showField,i=this.selector.options.showRightFiled,n=this.selector.options.showRight,r=e.length,l=!1,a=function(t,e,s){var r,l=h.optionClassName,e=t.index||e,s=t.subindex||s;return(t.disabled||t.Disabled)&&(l+=" "+h.disabledClassName),t==this.selector.selected&&(l+=" "+h.activeClassName),r='<li class="'+l+'" data-index="'+e+'"'+("number"==typeof s?' data-subindex="'+s+'"':"")+">",this.selector.data.length?"object"==typeof t?n?(r+='<span class="'+d+'">'+t[o]+"</span>",r+='<span class="'+c+'">'+t[i]+"</span>"):r+=t[o]:r+=t:this.selector.optionsData.length&&(t.rightText&&n?(r+='<span class="'+d+'">'+t.text+"</span>",r+='<span class="'+c+'">'+t.rightText+"</span>"):r+=t.text),r+="</li>"};if(r)for(var p=0;p<r;p++){var d="slwy-selector-option-left",c="slwy-selector-option-right",u=h.optgroupClassName,f=e[p];if(f.optgroup&&t.isArray(f.options)){s+='<li class="'+u+'">',s+=f.label,s+="</li>";for(var v=0;v<f.options.length;v++)s+=a.call(this,f.options[v],p,v)}else s+=a.call(this,f,p)}else s+='<li class="'+h.disabledClassName+'">抱歉，没有找到结果！</li>';l=/optgroup/.test(s),l&&this.$optionsList.addClass(h.hasOptgroupClassName),this.$optionsList.html(s).appendTo(this.$dropdown)},i.prototype.setListHeigth=function(){var t=this.$optionsList.find("li").outerHeight(),e=this.$optionsList.height()>t*this.selector.options.viewCount?t*this.selector.options.viewCount:this.$optionsList.height();this.$optionsList.css({maxHeight:e})},n.prototype.init=function(t){t.call(this)},n.prototype.render=function(t){t.call(this),this.dropdown.$dropdown.prepend(this.$search),this.$search.find("input").attr("placeholder",this.options.searchPlaceholder)},n.prototype.bind=function(e){e.call(this);var s=this;this.$search.find("input").on(p.keyupEvent+" "+p.inputEvent,function(e){var o=e.keyCode||e.which;if(o)for(var i=0;i<d.length;i++){var n,r=d[i].toString();if(r.indexOf("-")>=0){if(n=r.split("-"),o>=n[0]&&o<=n[1])return}else if(o==r)return}s.filter(t(this).val())})},n.prototype.filter=function(e,s){e.call(this);var o=this.data.length?this.options.showField:"text",i=this.options.showRight?this.data.length?this.options.showRightFiled:"rightText":null,n=this.data.length?this.data:this.optionsData,r=this.options.searchField,l=[],a=new RegExp("("+s.toString().toUpperCase()+")"),p=function(e,s,n,l){s.index=n,"number"==typeof l&&(s.subindex=l);var p=t.extend(!0,{},s);if(a.test(p[o].toString().toUpperCase())&&(p[o]=h(p[o]),e.push(p)),i&&p[i]&&a.test(p[i].toString().toUpperCase())&&(p[i]=h(p[i]),e.push(p)),r.length)for(var d=0;d<r.length;d++)p[r[d]]&&a.test(p[r[d]].toString().toUpperCase())&&e.push(p)},h=function(t){return t.replace(a,'<b class="slwy-selector-keyword">$&</b>')};if(s)for(var d=0;d<n.length;d++){var c=n[d];if(c.optgroup&&t.isArray(c.options)){var u={label:c.label,optgroup:!0,options:[]};if(a.test(c.label.toString().toUpperCase()))u.label=h(u.label),u.options=c.options;else for(var f=0;f<c.options.length;f++)p.call(this,u.options,c.options[f],d,f);!!u.options.length&&l.push(u)}else p.call(this,l,c,d)}else l=n;this.dropdown.render(l)},r.prototype.init=function(t){this.selected=this.getSelectedFormData(),this.optionsData=this.getSelectOptionData(),t.call(this)},r.prototype.bind=function(t){t.call(this);var e=this;this.$opener.on(p.clickEvent,function(t){e.show()}).on(p.keyupEvent,function(t){13===(t.keyCode||t.which)&&e.show()})},r.prototype.render=function(t){t.call(this);var e=this.options.showField,s=this.data.length?this.selected[e]:this.selected.text,o=this.selected;this.$srcElement.after(this.$opener.text(s).data("value",o).show()).hide()},r.prototype.getSelectedFormData=function(){var t=null;return this.data.length&&function(e,s){do{if(e[s].optgroup){arguments.callee.call(this,e[s].options,0)}else t=e[s];s++}while(t.Disabled||t.disabled)}(this.data,0),t},r.prototype.getSelectOptionData=function(){var e=this,s=this.$srcElement.find("option"),o=this.$srcElement.find("optgroup").length?this.$srcElement.find("optgroup"):null,i=[],n=function(s,o,i){var n=t(o).text(),r=t(o).data("right"),l=t(o).attr("value"),a=t(o).is(":disabled"),p={text:n,rightText:r,value:l,disabled:a};t(o).is(":selected")&&(e.selected=p),s.push(p)};return o?o.each(function(e,s){var o=t(s).find("option"),r=t(s).attr("label"),l={label:r,optgroup:!0,options:[]};o.each(function(t,e){n(l.options,e)}),i.push(l)}):s.each(function(t,e){n(i,e)}),i},t.fn.SlwySelector=function(e){var i=o;return e.search&&(i=s(i,n)),t(this).is("select")&&(i=s(i,r)),new i(e,t(this)).init(),t(this)}});